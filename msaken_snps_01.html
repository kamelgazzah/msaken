<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Msaken SNPS</title>
    <script src="js/site-header.js?id=571"></script>

    <!-- Treant -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/Treant.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/Treant.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0 10px;
            background: #ffffff;
        }

        /* ===== HEADER ===== */
        .page-header {
            text-align: center;
            margin: 20px auto 30px;
        }

        .page-header h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .page-header h2 {
            font-size: 16px;
            font-weight: normal;
            margin: 0;
        }

        .page-header p {
            font-size: 12px;
            color: #555;
            margin-top: 5px;
        }

        /* ===== TREE CONTAINER ===== */
        #tree-container {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 20px;
            touch-action: pan-x pan-y;
        }

        /* ===== NODE STYLE ===== */
        .node-box {
            padding: 6px 8px;
            font-size: 12px;
            line-height: 1.35;
            text-align: center;
            border-radius: 6px;
            border: 1px solid #444;
            background: #f8f8f8;
            min-width: 140px;
            user-select: none;
        }

        /* Branches terminales (*) */
        .terminal-node {
            border: 2px solid #000;
            font-weight: bold;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .node-box {
                font-size: 11px;
                min-width: 110px;
                padding: 5px;
            }
        }

        @media (max-width: 480px) {
            .node-box {
                font-size: 10px;
                min-width: 95px;
            }
        }
    </style>
</head>

<body>
    <site-header></site-header>
    <header class="page-header">
        <h1>Msaken SNP / Families Tree</h1>
        <h2>by <b>Kamel El Gazzah</b></h2>
        <p>Last update <b>13/01/2026</b></p>
    </header>

    <div id="tree-container"></div>

    <script>
        function hasValidName(item) {
            return item.name && item.name.trim() !== "";
        }
        const jsonData = [
            { "id": 5, "name": "J-L271", "snps": {}, "famille": "قصور مساكن الخمسة", "tmrca": "1810", "idroot": null },
            { "id": 6, "name": "J-L271*", "snps": {}, "famille": "محجوب", "tmrca": "1810", "idroot": 63 },
            { "id": 7, "name": "J-FGC32594", "snps": {}, "famille": "", "tmrca": "1630", "idroot": 5 },
            { "id": 8, "name": "J-FGC32594*", "snps": {}, "famille": "قم", "tmrca": "1630", "idroot": 82 },
            { "id": 9, "name": "J-Z43715", "snps": {}, "famille": "", "tmrca": "1570", "idroot": 7 },
            { "id": 10, "name": "J-A14971", "snps": {}, "famille": "بن سيك علي", "tmrca": "1570", "idroot": 101 },
            { "id": 12, "name": "J-FGC32589", "snps": {}, "famille": "", "tmrca": "995", "idroot": 9 },
            { "id": 13, "name": "J-FGC37143", "snps": {}, "famille": "الشّطّي", "tmrca": "850", "idroot": 12 },
            { "id": 14, "name": "J-FGC32589*", "snps": {}, "famille": "القزّاح", "tmrca": "995", "idroot": 12 },
            { "id": 15, "name": "J-Y200779", "snps": {}, "famille": "", "tmrca": "1500", "idroot": 9 },
            { "id": 16, "name": "J-Y200779*", "snps": {}, "famille": "بوهلال", "tmrca": "1500", "idroot": 15 },
            { "id": 17, "name": "J-Y209473", "snps": {}, "famille": "بن عبد الله", "tmrca": "700", "idroot": 15 },

            { "id": 41, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 2 },
            { "id": 42, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 41 },
            { "id": 43, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 42 },
            { "id": 44, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 43 },
            { "id": 45, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 44 },

            { "id": 61, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 5 },
            { "id": 62, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 61 },
            { "id": 63, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 62 },

            { "id": 81, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 7 },
            { "id": 82, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 81 },

            { "id": 101, "name": "", "snps": {}, "famille": "", "tmrca": "", "idroot": 9 }
        ];


        /* ================================
           UTILITAIRES
        ================================ */
        function hasValidName(item) {
            return item.name && item.name.trim() !== "";
        }

        /* ================================
           COULEURS PAR FAMILLE
        ================================ */
        const familyColors = {};
        const colorPalette = [
            "#e3f2fd", "#fce4ec", "#e8f5e9",
            "#fff3e0", "#ede7f6", "#f3e5f5",
            "#e0f2f1", "#f9fbe7"
        ];
        let colorIndex = 0;

        function getFamilyColor(famille) {
            if (!famille) return "#f8f8f8";
            if (!familyColors[famille]) {
                familyColors[famille] = colorPalette[colorIndex++ % colorPalette.length];
            }
            return familyColors[famille];
        }

        /* ================================
           HTML DES NŒUDS
        ================================ */
        function buildNodeHTML(item) {
            let html = `<strong>${item.name}</strong><br>`;
            if (item.famille) html += `${item.famille}<br>`;
            html += `TMRCA : ${item.tmrca || "Inconnu"}`;
            return html;
        }

        /* ================================
           INDEX DES ENFANTS
        ================================ */
        const childrenMap = {};
        jsonData.forEach(item => {
            if (!childrenMap[item.idroot]) {
                childrenMap[item.idroot] = [];
            }
            childrenMap[item.idroot].push(item);
        });

        /* ================================
           CONSTRUCTION RÉCURSIVE DE L'ARBRE
        ================================ */
        function buildTreeNode(item) {
            const children = (childrenMap[item.id] || [])
                .map(child => buildTreeNode(child))
                .filter(Boolean);

            // ⛔ Nœud sans nom → transparent
            if (!hasValidName(item)) {
                if (children.length === 0) return null;
                if (children.length === 1) return children[0];
                return { children };
            }

            return {
                innerHTML: buildNodeHTML(item),
                HTMLclass:
                    "node-box" +
                    (item.name.endsWith("*") ? " terminal-node" : ""),
                children
            };
        }

        /* ================================
           RACINE
        ================================ */
        const rootItem = jsonData.find(n => n.idroot === null);
        const nodeStructure = buildTreeNode(rootItem);

        /* ================================
           RENDER TREANT
        ================================ */
        new Treant({
            chart: {
                container: "#tree-container",
                rootOrientation: "NORTH",
                nodeAlign: "CENTER",
                connectors: { type: "step" },
                levelSeparation: window.innerWidth < 768 ? 100 : 80
            },
            nodeStructure
        });

        /* ================================
           COLORATION DES FAMILLES
        ================================ */
        setTimeout(() => {
            jsonData.forEach(item => {
                if (!item.famille) return;

                Array.from(document.getElementsByClassName("node-box")).forEach(el => {
                    if (el.innerHTML.includes(item.famille)) {
                        el.style.background = getFamilyColor(item.famille);
                    }
                });
            });
        }, 0);
    </script>



</body>

</html>